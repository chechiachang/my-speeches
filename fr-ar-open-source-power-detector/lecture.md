
Hi 各位好
我是 linkernetworks 的後端工程師，主要技能是 golang kubernetes

# 起因

有看過七龍珠嗎？沒看過的請舉手。知道什麼是戰鬥力探測器。

一個工程師走進一個ＣＯＳＣＵＰ會場，
走進來就感覺這裡有個氣場，很多人都看起來都很厲害，都是大大。可是都不認得。

沒認出大大
但要怎麼

刷臉就可以知道在座的各位，誰是大大。

# Live Demo

給我幾秒鐘把 App 開起來。

# Archetecture

這個玩意是怎麼做的?

如果要刷臉取得開源貢獻值，馬上會想到什麼？Github
所以架構其實很簡單：
從 github 上面把使用者的數據，包含 follow 數量跟 contribution 數量，加上使用者頭像，全部下載下來放到資料庫中。
把使用者頭像抓出來做人臉辨識。
前端從頭像算出這個使用者的ＩＤ，然後去資料庫把使用者資料撈出來，在前端秀出來。

刷臉取得貢獻值，大體上就是這樣做。

# Data mining

辨識的第一步，先取得數據。我們要取得 github 的使用者數據

Github 的 api 做得非常好使用，花一點時間嘗試，不需要很深的技術就可以輕鬆接完。

這邊我用 golang 寫了幾個接 github API 的小程式，放一個晚上，把location 在台灣的 14000 名使用者的使用者數據抓下來。

contribution 比較麻煩，github 因為某些原因是沒有出 contribution api 的，所以做了一個簡單的 html parser 去把綠綠的那張表，趴出歷年contribution。

有的數據後，再來要開始產生臉部特徵值。

# Face detection and Face recognition

這個是他們 github 上的標語
他們說的是真的，這個人臉辨識的 api 真的超簡單

首先要做資料預處理，把頭像的資料夾，用這個 api 跑過，篩選有人臉的圖片。
14000 張頭像，因為大家普遍都不用自己的頭像，大概剩 3000 張。

間單來說一下原理，
我們手上現在有 3000 張，把這3000 張臉，用API算出各自的臉部特徵值，然後放進一個高維度的矩陣。
拿一張未知的人臉，API 會去算人臉在高維度矩陣中，距離哪張已知的臉最近。

這樣就算出未知的臉應該是哪位使用者。

# API server

因為要接 face recognition api，所以就用 Python 寫了 API server ，使用 flask framework。寫起來非常直覺簡單。
要做的事情是接受 App 端傳來的人臉圖片，然後透過 face recognition api 去找到最像的使用者，再從資料庫回傳使用者數據。

# App and AR Unity

為何會選用 Unity？因為炫。Unity 有非常多的工具，比較容易做到像遊戲或是動畫中的效果。

除了效果，我還需要在 app 端作人臉辨識。
因為不想要幫整個是視訊串流都送到後端，頻寬跟apiserver 壓力太大。
所以找了一些 Unity 的 face tracker 飯粒，拿來自己改。

不過我在這邊花了做多時間。
1. 我沒用過 Unity
2. 我沒寫過C#
3. 我使用的人臉辨識 tool 與算法是 dlib，最常用的是 c++ 跟 Python。C# 的整合並不好。

寫起來很痛苦，幾度想要放棄，就用 javascript 搭一個前端頁面就好。但後來還是繼續做下去。

我做這個專案，是做夢的專案。追的就是一個童年。當然要選一個看起來最好玩的前端。
撇開技術上各種卡關以外，十分痛苦，Unity 做起來真的是很好玩。

# Workflow

有 Unity App ，透過攝影機取得人臉

前端人臉辨識，Unity別人家好的外面包了一層 wrapper ，讓 C# 跟 .Net 吃了下去。
C# 透過 OpenCV 做影像的處理，並把人臉截圖，傳送到後端。

1. 影像從 app 端使用筆電跟手機的 camera
2. Unity app 把人臉送到 API server
3. API server 透過 face recognition api，把人臉轉成特徵值，跟預先做好的 3000臉特徵值矩陣做運算
4. API server 取得最像人臉後，去資料庫把使用者數據悚到前端
5. Unity app 把資料打在前端

# Issues

1. Data source：
大家都不用自己的臉當頭像，14000 中只有 3000，然後圖片不見得清晰，或是臉不夠正面...問題很多
資料基礎上就有問題
2. 3000 張的臉，簡易的 face recognition API 是否能夠容納？
3. 自身能力不足，我自己對 Unity 跟 C# 實在太不熟了，很多地方的接口都有問題，其實後面 apiserver 各種 error 狂噴，不過各位看不到 XD

結論：『不是不準，只是正確機率不夠高。』

# Review

回顧一下，左邊是做這整個專案所用到的工具

右邊這一欄是什麼呢？
這個是我在做這個專案前，我會的東西

我是後端工程師，golang 跟 bash 還有 kubernetes

我想分享的是一個越級打怪，一邊快速成長的捷徑。

# Summary

這個專案從結果來說，是一個很不準的專案。這個東西就算準了，除了cosplay 外好像也沒什麼用途。

所以說，這是一個愛與勇氣的故事
追尋的是一個童年，以及對寫程式的熱愛

不是在寫客戶要的，公司要的，主管要的。工作上也有很多有趣的事情。
我自己想做的東西。

另外，COSCUP 給很大的動力，跟時間壓力
報COSCUP 只需要勇氣
台灣有很多很不錯的研討會，大家真的要踴躍參加，收穫最多的絕對是自己。

想參加Hackson？
想有個人代表作？
先報 COSCUP 來講個 session ，n 個願望一次滿足。

# The end

因為我自己想做，還有當初推坑我的人太厲害。

